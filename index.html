<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Policy Index Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 700;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .calculator-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            border: 2px solid #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 20px 0;
        }
        .input-group {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .input-group label {
            font-weight: 600;
            color: #2c3e50;
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        .input-group input:focus, .input-group select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        .time-input-container {
            display: flex;
            gap: 10px;
        }
        .time-input-container input {
            flex: 2;
        }
        .time-input-container select {
            flex: 1;
        }
        .calculate-button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 20px auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        .calculate-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        .results-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            display: none;
            border: 2px solid #27ae60;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.1);
        }
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .result-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .result-card h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }
        .result-value {
            font-size: 24px;
            font-weight: 700;
            color: #3498db;
            margin: 5px 0;
        }
        .color-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin: 10px 0;
        }
        .library-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .library-info input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .formula-display {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .progress-bar {
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 25%, #f1c40f 50%, #2ecc71 75%, #3498db 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        .export-section {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .export-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .export-pdf {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .export-excel {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        .export-json {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
        }
        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .benchmark-section {
            background-color: #fff9e6;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
            margin: 20px 0;
        }
        .benchmark-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .benchmark-table th, .benchmark-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .benchmark-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .validation-message {
            background-color: #ffeaa7;
            color: #d63031;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
            border-left: 4px solid #d63031;
        }
        @media (max-width: 768px) {
            .input-grid, .results-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 20px;
            }
            .export-section {
                flex-direction: column;
                align-items: center;
            }
        }
        @media print {
            body {
                background: white;
            }
            .export-section, .calculate-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧮 Interactive Policy Index Calculator</h1>
        <p class="subtitle">Advanced Library Performance Assessment Tool</p>
        
        <div class="library-info">
            <h3>📚 Library Information</h3>
            <input type="text" id="libraryName" placeholder="Library Name" style="margin-bottom: 10px;">
            <input type="text" id="institution" placeholder="Institution/Organization" style="margin-bottom: 10px;">
            <input type="date" id="assessmentDate" style="margin-bottom: 10px;">
            <input type="text" id="assessor" placeholder="Assessor Name" style="margin-bottom: 10px;">
        </div>

        <div class="calculator-section">
            <h3>🔢 Policy Index Calculation Parameters</h3>
            
            <div class="formula-display">
                Pi = (ccn × hr) / (a × k) × (1/t)
            </div>
            
            <div class="validation-message" id="validationMessage">
                Please fill in all required fields with valid numbers.
            </div>
            
            <div class="input-grid">
                <div class="input-group">
                    <label for="ccn">📋 Cumulative Checkbox Number (ccn)</label>
                    <input type="number" id="ccn" placeholder="Total policies implemented" min="0" max="1000">
                    <small style="color: #7f8c8d;">Total number of policies implemented across all domains</small>
                </div>
                
                <div class="input-group">
                    <label for="totalPolicies">📊 Total Policy Procedures</label>
                    <input type="number" id="totalPolicies" value="350" placeholder="Maximum possible policies" min="1">
                    <small style="color: #7f8c8d;">Standard: 350 Pi (advanced libraries: 1000+ Pi)</small>
                </div>
                
                <div class="input-group">
                    <label for="requiredStaff">👥 Required Staff Capacity</label>
                    <input type="number" id="requiredStaff" placeholder="Optimal staff needed" min="1">
                    <small style="color: #7f8c8d;">Ideal number of staff for optimal operations</small>
                </div>
                
                <div class="input-group">
                    <label for="totalStaff">👨‍💼 Total Staff Capacity</label>
                    <input type="number" id="totalStaff" placeholder="Current staff count" min="1">
                    <small style="color: #7f8c8d;">Current number of staff members</small>
                </div>
                
                <div class="input-group">
                    <label for="libraryAge">🏛️ Library Age (years)</label>
                    <input type="number" id="libraryAge" placeholder="Years since establishment" min="1" max="200">
                    <small style="color: #7f8c8d;">Number of years since library establishment</small>
                </div>
                
                <div class="input-group">
                    <label for="timeValue">⏱️ Implementation Time</label>
                    <div class="time-input-container">
                        <input type="number" id="timeValue" placeholder="Time value" min="1">
                        <select id="timeUnit">
                            <option value="1">Hours</option>
                            <option value="24">Days</option>
                            <option value="168">Weeks</option>
                            <option value="730">Months</option>
                            <option value="8760" selected>Years</option>
                        </select>
                    </div>
                    <small style="color: #7f8c8d;">Time taken to implement current policies</small>
                </div>
            </div>
            
            <button class="calculate-button" onclick="calculatePolicyIndex()">
                🚀 Calculate Policy Index
            </button>
        </div>

        <div class="results-section" id="resultsSection">
            <h3>📊 Calculation Results</h3>
            
            <div class="results-grid">
                <div class="result-card">
                    <h4>Human Resource Index (HR)</h4>
                    <div class="result-value" id="hrValue">--</div>
                    <div id="hrStatus" style="font-size: 14px; color: #7f8c8d;">--</div>
                </div>
                
                <div class="result-card">
                    <h4>Policy Index (Pi)</h4>
                    <div class="result-value" id="piValue">--</div>
                    <div style="font-size: 14px; color: #7f8c8d;">Primary performance metric</div>
                </div>
                
                <div class="result-card">
                    <h4>Color Code Percentage (CCP)</h4>
                    <div class="result-value" id="ccpValue">--</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>Library Color Code</h4>
                    <div class="color-badge" id="colorBadge">Not Calculated</div>
                    <div id="colorDescription" style="font-size: 12px; margin-top: 5px;">--</div>
                </div>
            </div>
            
            <div class="benchmark-section">
                <h4>📈 Performance Analysis & Benchmarking</h4>
                <div id="performanceAnalysis">
                    <p id="overallAssessment">--</p>
                    <p id="staffingAnalysis">--</p>
                    <p id="recommendations">--</p>
                </div>
                
                <table class="benchmark-table">
                    <thead>
                        <tr>
                            <th>Library Type</th>
                            <th>Typical CCP Range</th>
                            <th>Your Performance</th>
                            <th>Gap Analysis</th>
                        </tr>
                    </thead>
                    <tbody id="benchmarkTableBody">
                        <tr>
                            <td>Research Universities</td>
                            <td>60-85%</td>
                            <td id="universityGap">--</td>
                            <td id="universityAnalysis">--</td>
                        </tr>
                        <tr>
                            <td>Public Libraries</td>
                            <td>40-65%</td>
                            <td id="publicGap">--</td>
                            <td id="publicAnalysis">--</td>
                        </tr>
                        <tr>
                            <td>Academic Colleges</td>
                            <td>45-70%</td>
                            <td id="collegeGap">--</td>
                            <td id="collegeAnalysis">--</td>
                        </tr>
                        <tr>
                            <td>Special Libraries</td>
                            <td>35-60%</td>
                            <td id="specialGap">--</td>
                            <td id="specialAnalysis">--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="export-section" id="exportSection" style="display: none;">
            <button class="export-button export-pdf" onclick="exportToPDF()">
                📄 Export PDF Report
            </button>
            <button class="export-button export-excel" onclick="exportToExcel()">
                📊 Export to Excel
            </button>
            <button class="export-button export-json" onclick="exportToJSON()">
                💾 Export Data (JSON)
            </button>
            <button class="export-button" onclick="saveCalculation()" style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white;">
                💾 Save Calculation
            </button>
        </div>
    </div>

    <script>
        let calculationData = {};

        function validateInputs() {
            const ccn = parseFloat(document.getElementById('ccn').value);
            const requiredStaff = parseFloat(document.getElementById('requiredStaff').value);
            const totalStaff = parseFloat(document.getElementById('totalStaff').value);
            const libraryAge = parseFloat(document.getElementById('libraryAge').value);
            const timeValue = parseFloat(document.getElementById('timeValue').value);
            const totalPolicies = parseFloat(document.getElementById('totalPolicies').value);

            const validationMessage = document.getElementById('validationMessage');
            
            if (isNaN(ccn) || isNaN(requiredStaff) || isNaN(totalStaff) || isNaN(libraryAge) || isNaN(timeValue) || isNaN(totalPolicies)) {
                validationMessage.style.display = 'block';
                validationMessage.textContent = 'Please fill in all required fields with valid numbers.';
                return false;
            }
            
            if (ccn < 0 || requiredStaff <= 0 || totalStaff <= 0 || libraryAge <= 0 || timeValue <= 0 || totalPolicies <= 0) {
                validationMessage.style.display = 'block';
                validationMessage.textContent = 'All values must be positive numbers.';
                return false;
            }
            
            if (ccn > totalPolicies) {
                validationMessage.style.display = 'block';
                validationMessage.textContent = 'Implemented policies cannot exceed total possible policies.';
                return false;
            }
            
            validationMessage.style.display = 'none';
            return true;
        }

        function calculatePolicyIndex() {
            if (!validateInputs()) {
                return;
            }

            // Get input values
            const ccn = parseFloat(document.getElementById('ccn').value);
            const requiredStaff = parseFloat(document.getElementById('requiredStaff').value);
            const totalStaff = parseFloat(document.getElementById('totalStaff').value);
            const libraryAge = parseFloat(document.getElementById('libraryAge').value);
            const timeValue = parseFloat(document.getElementById('timeValue').value);
            const timeUnit = parseFloat(document.getElementById('timeUnit').value);
            const totalPolicies = parseFloat(document.getElementById('totalPolicies').value);
            
            // Calculate HR Index
            const hr = (requiredStaff / totalStaff) * 100;
            
            // Convert time to hours for consistency
            const timeInHours = timeValue * timeUnit;
            
            // Calculate Policy Index using the formula: Pi = (ccn × hr) / (a × k) × (1/t)
            const k = 5; // Consistency block time (5 years)
            const a = libraryAge;
            const t = timeInHours;
            
            const pi = (ccn * (hr/100)) / (a * k) * (1/t) * 8760; // Normalize to yearly basis
            
            // Calculate Color Code Percentage
            const ccp = Math.min((pi / totalPolicies) * 100, 100); // Cap at 100%
            
            // Store calculation data
            calculationData = {
                libraryInfo: {
                    name: document.getElementById('libraryName').value || 'Unnamed Library',
                    institution: document.getElementById('institution').value || 'Not specified',
                    assessmentDate: document.getElementById('assessmentDate').value || new Date().toISOString().split('T')[0],
                    assessor: document.getElementById('assessor').value || 'Anonymous'
                },
                inputs: { ccn, requiredStaff, totalStaff, libraryAge, timeValue, timeUnit, totalPolicies },
                results: { hr, pi, ccp },
                timestamp: new Date().toISOString()
            };
            
            // Determine color code and ranking
            const colorData = getColorCode(ccp);
            
            // Display results
            displayResults(hr, pi, ccp, colorData);
            
            // Show results section and export buttons
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('exportSection').style.display = 'flex';
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            
            // Update benchmark analysis
            updateBenchmarkAnalysis(ccp, hr, pi);
        }

        function getColorCode(ccp) {
            if (ccp >= 75) {
                return {
                    code: "🥇 Golden",
                    ranking: "Golden Libraries",
                    description: "Exemplary policy implementation with comprehensive coverage",
                    bgColor: "#FFD700",
                    textColor: "black"
                };
            } else if (ccp >= 50) {
                return {
                    code: "🥈 Silver",
                    ranking: "Silver Libraries",
                    description: "Strong policy implementation with substantial coverage",
                    bgColor: "#C0C0C0",
                    textColor: "black"
                };
            } else if (ccp >= 26) {
                return {
                    code: "🟢 Green",
                    ranking: "Green Libraries",
                    description: "Moderate policy implementation with room for improvement",
                    bgColor: "#27ae60",
                    textColor: "white"
                };
            } else if (ccp >= 1) {
                return {
                    code: "🔵 Blue",
                    ranking: "Blue Libraries",
                    description: "Basic policy implementation - significant development needed",
                    bgColor: "#3498db",
                    textColor: "white"
                };
            } else {
                return {
                    code: "⚫ No Color",
                    ranking: "Unranked",
                    description: "No policy documentation - immediate action required",
                    bgColor: "#95a5a6",
                    textColor: "white"
                };
            }
        }

        function displayResults(hr, pi, ccp, colorData) {
            // Update HR result
            document.getElementById('hrValue').textContent = `${hr.toFixed(2)}%`;
            let hrStatusText, hrStatusColor;
            if (hr > 110) {
                hrStatusText = "Significantly Understaffed";
                hrStatusColor = "#e74c3c";
            } else if (hr > 100) {
                hr
